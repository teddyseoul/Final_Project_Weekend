<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="FestiMapper">
	
	<select id="getNum" resultType="Integer">
		SELECT FESTI_SEQ.NEXTVAL FROM DUAL
	</select>

	<insert id="setWrite" parameterType="FestiDTO">
		INSERT INTO FESTI(NUM, TITLE, WRITER, CONTENTS, REG_DATE, HIT, CATEGORY, PRICE, TOTAL, STARTDATE, ENDDATE, LOCAL, TOP)
		VALUES(#{num},#{title},#{writer},#{contents},sysdate,#{hit},#{category},#{price},#{total},#{startDate},#{endDate},#{local},#{top})
	</insert>
	
	<resultMap type="FestiDTO" id="festiResult">
		<id column="num" property="num"/>
		<result column="title" property="title"/>
		<result column="startDate" property="startDate"/>
		<result column="endDate" property="endDate"/>
		<result column="local" property="local"/>
		<collection property="fileDTOs" javaType="List" ofType="FileDTO">
			<id column="fnum" property="fnum"/>
			<result column="num" property="num"/>
			<result column="fname" property="fname"/>
			<result column="oname" property="oname"/>
		</collection>
	</resultMap>
	<select id="getList" parameterType="PageMaker" resultMap="festiResult">
		SELECT * FROM 
		(SELECT ROWNUM R, F.* FROM 
		(SELECT NUM, TITLE, STARTDATE, ENDDATE, LOCAL FROM FESTI
		WHERE <!-- CATEGORY = #{category} AND -->
		<choose>
			<when test="kind = 1">
				TITLE
			</when>
			<when test="kind = 2">
				CONTENTS
			</when>
			<when test="kind = 3">
				LOCAL
			</when>
			<otherwise>
				TITLE
			</otherwise>
		</choose>
		LIKE '%'||#{search}||'%'
		ORDER BY NUM DESC) F) 
		WHERE R BETWEEN #{startRow} AND #{lastRow}
	</select>
	
	<select id="getCount" resultType="Integer">
		SELECT COUNT(NUM) FROM FESTI
	</select>
	
</mapper>